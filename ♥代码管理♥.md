# 加顿号

```
  orderInfo?.orderNoAndCodeList.map((item: any, index: number) => (
                     <span key={item.name}>
                     <NavLink to={`/trading/order/detail?code=${item.value}`}>
                      {item.name}
                     </NavLink>
                     {index < orderInfo?.orderNoAndCodeList.length - 1 && '、'}
                                </span>
                            ))
```

# filterNum filterTaxRate 金额.00 百分比

```
const filterNum = (price: number | string) => {
    if (!price && typeof price !== 'number') return ''
    return Number(price).toFixed(2)
}
const filterTaxRate = (taxrate: number | string) => {
    if (!taxrate && typeof taxrate !== 'number') return ''
    return Number(taxrate) * 100
}

export { filterNum, filterTaxRate }
```

# 时间戳 dayjs

```
import dayjs from 'dayjs';

// 获取当前时间的时间戳   精确到毫秒  精确到秒是unix()
const currentTimestamp = dayjs().valueOf();  

// 获取当天的开始时间和结束时间的时间戳
const todayStartTimestamp = dayjs().startOf('day').valueOf();
const todayEndTimestamp = dayjs().endOf('day').valueOf();

// 计算当前时间戳相对于当天时间戳的百分比
const percentage = ((currentTimestamp - todayStartTimestamp) / (todayEndTimestamp - todayStartTimestamp)) * 100;

console.log(`当前时间戳占当天时间戳的百分比：${percentage.toFixed(2)}%`);


 /**  处理保存的数据  */
    /**  时间处理 精确到秒 */
 const dateFields = ['applyEndTime', ]
        dateFields.forEach(field => {
            params[field] = values[field] ? dayjs(values[field]).unix() * 1000 : undefined
        })
  /**  时间处理 精确到毫秒 */
 const dateFields_activity = ['activityEnd', 'activityStart']
 dateFields_activity.forEach(field => {
    params[field] = values[field] ? dayjs(values[field]).valueOf() : undefined
     })

回显
 /**  封面  */
        data.cover = data.cover
            ? [
                  {
                      uid: '-1',
                      name: 'image.png',
                      status: 'done',
                      url: data.cover,
                  },
              ]
            : []

 /**  时间处理  */
        const dateFields = [   'activityEnd', ]
        dateFields.forEach(field => {
            data[field] = data[field] ? dayjs(data[field]) : undefined
        })





















```

# textarea 加边框

```
 textarea {
            border: 1px solid #d9d9d9;
            border-radius: 6px;
        }
        textarea.ant-input:hover,
        textarea:focus {
            border: 1px solid #1890ff;
            border-radius: 6px;
            -webkit-box-shadow: none;
            box-shadow: none;
        }
```

# 复制链接 图片 下载海报

```
import copy from 'copy-to-clipboard'
   <svg
                                className={classnames('icon', styles.icon)}
                                aria-hidden="true"
                                style={{ fill: '#1678FF', marginLeft: 8 }}
                                onClick={() => {
                                    copy(email)
                                    Toast.show('复制成功')
                                }}
                            >
                                <use xlinkHref="#fuzhi" />
                            </svg>
```

```
import Clipboard from 'clipboard'

// data-clipboard-text={xxx}


/**
     *  复制报名链接
     */
    const copy = new Clipboard('.copy-btn')
    copy.on('success', function (e) {
        message.success('复制链接成功')
        e.clearSelection()
    })
    copy.on('error', function (e) {
        message.error('复制失败')
        console.error('Action:', e.action)
        console.error('Trigger:', e.trigger)
    })

    /**
     *  销毁实例
     *  */
    useEffect(() => {
        return () => {
            copy.destroy()
        }
    }, [copy])

                    <div className={styles.link}>
                        <span className={styles.enroll_link} id="copy_content">
                            {`${getEnrollMobilePath()}&applyChannel=${
                                ENROLL_CHANNEL_ENUM[ENROLL_CHANNEL.LINK]
                            }`}
                        </span>
                        <Button
                            data-clipboard-target="#copy_content"
                            type="primary"
                            className={'copy-btn'}
                        >
                            复制
                        </Button>
                    </div>
```

```
  /**
     * 优化后的复制二维码图片   //注:此方法只能在localhost跟https协议下可用,http协议下不存在此方法
     * 将base64转成blob格式
     * @returns {*}
     */
    const base64ToBlob = (urlData: any, _type: any) => {
        const arr = urlData.split(',')
        const mime = arr[0].match(/:(.*?);/)[1] || _type
        // 去掉url的头，并转化为byte
        const bytes = window.atob(arr[1])
        // 处理异常,将ascii码小于0的转换为大于0
        const ab = new ArrayBuffer(bytes.length)
        // 生成视图（直接针对内存）：8位无符号整数，长度1个字节
        const ia = new Uint8Array(ab)
        for (let i = 0; i < bytes.length; i++) {
            ia[i] = bytes.charCodeAt(i)
        }
        return new Blob([ab], {
            type: mime,
        })
    }

    /**
     * 复制二维码图片\
     */
    const clickCopyImgCode = async () => {
        // 将 qrcode 生成的二维码利用canvas自带的 toDataURL 转成base64 格式 然后再转成 Blob格式 使用 clipboard.write 复制
        const canvasImg: any = document.getElementById('QR-code') // 获取canvas类型的二维码
        const file = canvasImg?.toDataURL('image/jpg')
        // eslint-disable-next-line @typescript-eslint/no-shadow
        const type = 'image/png'
        const conversions = base64ToBlob(file, type)
        try {
            await navigator.clipboard.write([
                // eslint-disable-next-line no-undef
                new ClipboardItem({
                    [conversions.type]: conversions,
                }),
            ])
            message.success('复制二维码成功')
        } catch (error) {
            message.error('请在https协议下操作')
        }
    }








                    <div className={styles.qrcode}>
                        <QRCode
                            id="QR-code"
                            value={`${getEnrollMobilePath()}&applyChannel=${
                                ENROLL_CHANNEL_ENUM[ENROLL_CHANNEL.QRCODE]
                            }`}
                            size={112}
                            fgColor="#000000"
                            className={styles.qrcode_img}
                        />
                        <Button type="primary" onClick={() => clickCopyImgCode()}>
                            复制
                        </Button>
                    </div>
```

```
import html2canvas from 'html2canvas'

/**
     * 下载海报
     */
    const downloadScreenshot = () => {
        const element = document.querySelector('#div_to_capture')

        // 获取所有的图片元素
        const images = element.querySelectorAll('img')
        let loadedCount = 0

        // 监听图片加载完成事件
        images.forEach(image => {
            if (image.complete) {
                // 图片已经加载完成
                handleImageLoad()
            } else {
                // 图片未加载完成，绑定load事件监听
                image.addEventListener('load', handleImageLoad)
            }
        })

        function handleImageLoad() {
            loadedCount++

            if (loadedCount === images.length) {
                // 使用 HTML2Canvas 创建画布并截取 div
                html2canvas(element, {
                    useCORS: true,
                    scrollY: 0,
                    scrollX: 0,
                    backgroundColor: null,
                    logging: false,
                }).then(canvas => {
                    // 将画布转化为图像 URL
                    const imgURL = canvas.toDataURL()
                    // 创建一个 a 标签用于下载图片
                    const link = document.createElement('a')
                    link.href = imgURL
                    link.download = '报名海报.png'

                    // 将标签添加到页面
                    document.body.appendChild(link)

                    link.click()
                    document.body.removeChild(link)
                })
            }
        }
    }




<div className={styles.poster_div}>
                        <div className={styles.poster} id="div_to_capture">
                            {Number(type) === Number(TYPE_ENUM.ORG) ? orgPoster() : planPoster()}
                        </div>
                        <Button onClick={downloadScreenshot} icon={<DownloadOutlined />}>
                            下载
                        </Button>
                    </div>
```

```
  const posterRef = useRef<HTMLDivElement>(null)
  <div className={styles.poster_wrapper} ref={posterRef}></div>

    /**  点击保存海报  */
    const onSavePoster = () => {
        if (posterRef) {
            html2canvas(posterRef.current!, {
                useCORS: true,
                scrollY: 0,
                scrollX: 0,
                backgroundColor: null,
            }).then(canvas => {
                // 将画布转化为图像 URL
                const imgURL = canvas.toDataURL()
                // 创建一个 a 标签用于下载图片
                const linkDOM = document.createElement('a')
                linkDOM.href = imgURL
                linkDOM.download = '练习海报.png'

                // 将标签添加到页面
                document.body.appendChild(linkDOM)

                linkDOM.click()
                document.body.removeChild(linkDOM)
            })
        }
    }
```

```
    const onSaveImg = () => {
        handler.current = Toast.show({
            icon: 'loading',
        })
        html2canvas(canvasRef.current!, {
            useCORS: true,
            scrollY: 0,
            scrollX: 0,
            allowTaint: true,
            imageTimeout:30000,
        
            backgroundColor: null,
        })
            .then(canvas => {
                // 将画布转化为图像 URL
                const imgURL = canvas.toDataURL()
                // 创建一个 a 标签用于下载图片
                const link = document.createElement('a')
                link.href = imgURL
                link.download = '报名海报.png'
                // 将标签添加到页面
                document.body.appendChild(link)
                link.click()
                document.body.removeChild(link)
                // 关闭loading toast
                handler.current?.close()
                Toast.show({
                    icon: 'success',
                    content: '保存成功',
                })
            })
            .catch(() => {
                Toast.show({
                    icon: 'fail',
                    content: '保存失败',
                })
            })
    }
```

# 滚动条 scrollbar

```
  .prevBox::-webkit-scrollbar {
        width: 6px;
        height: 6px;
    }
    .prevBox::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.06);
        border-radius: 3px;
        -webkit-box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.08);
    }
    .prevBox::-webkit-scrollbar-thumb {
        background: rgba(0, 0, 0, 0.12);
        border-radius: 3px;
        -webkit-box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.2);
    }
```

# 模糊搜索高亮显示

```
    //开票类别  1蓝色 2红色  模糊搜索高亮显示
    const showColor = (type: number, light: string) => {
        if (!search) {
            switch (type) {
                case 1:
                    return <span style={{ color: '#1890ff' }}>{light}</span>
                case 2:
                    return <span style={{ color: '#ec808d' }}>{light}</span>
                default:
                    return <span>{'-'}</span>
            }
        }
        const reg = new RegExp(search, 'ig')
        const splitIconTypes = light.split(reg)
        const matchIconTypes = light.match(reg) as string[]

        const res = splitIconTypes.toString().split('-')

        if (search.length !== light.length) {
            return (
                <React.Fragment>
                    {matchIconTypes &&
                        matchIconTypes.map((_, index) => {
                            return (
                                <React.Fragment key={index}>
                                    <span style={{ color: type === 2 ? '#ec808d' : '' }}>
                                        {splitIconTypes[index]}
                                    </span>
                                    <span style={{ color: 'orange' }}>{matchIconTypes[index]}</span>
                                </React.Fragment>
                            )
                        })}
                    <span style={{ color: type === 2 ? '#ec808d' : '' }}>
                        {splitIconTypes[splitIconTypes.length - 1] || ''}
                    </span>
                </React.Fragment>
            )
        } else {
            return (
                <React.Fragment>
                    {matchIconTypes &&
                        matchIconTypes.map((_, index) => {
                            return (
                                <React.Fragment key={index}>
                                    <span style={{ color: type === 2 ? '#ec808d' : '' }}>
                                        {splitIconTypes[index]}
                                    </span>
                                    <span style={{ color: 'orange' }}>{matchIconTypes[index]}</span>
                                </React.Fragment>
                            )
                        })}
                    {res.map((item, index) => {
                        if (search.includes(item) && index === 1) {
                            return (
                                <React.Fragment key={index}>
                                    <span style={{ color: type === 2 ? '#ec808d' : '' }}>
                                        {res[index - 1]}
                                        {'-'}
                                    </span>
                                    <span style={{ color: 'orange' }}>{res[index]}</span>
                                </React.Fragment>
                            )
                        } else if (search.includes(item) && index === 0) {
                            return (
                                <React.Fragment key={index}>
                                    <span style={{ color: 'orange' }}>{res[index]}</span>
                                    <span style={{ color: type === 2 ? '#ec808d' : '' }}>
                                        {'-'}
                                        {res[index + 1]}
                                    </span>
                                </React.Fragment>
                            )
                        }
                    })}
                </React.Fragment>
            )
        }
    }

    // switch (type) {
    //     case 1:
    //         return <span dangerouslySetInnerHTML={{ __html: invoiceNo }}></span>
    //     case 2:
    //         return (
    //             <span
    //                 dangerouslySetInnerHTML={{ __html: invoiceNo }}
    //                 style={{ color: '#ec808d' }}
    //             ></span>
    //         )
    // }
    // }
```

# 账号和eslint

```
/* stylelint-disable selector-class-pattern */

rm -rf node_modules/
```

# 转树状解构 tree 树转list

```
let arr: any[] = []

            const itemMap = new Map()

            for (const item of res) {
                item.children = []
                itemMap.set(item.key, item)
            }

            for (const item of res) {
                const parentKey = item.pid
                if (parentKey !== 0) {
                    const parentItem = itemMap.get(parentKey)
                    if (parentItem) {
                        parentItem.children.push(item)
                    } else {
                        arr.push(item)
                    }
                } else {
                    arr.push(item)
                }
            }

console.log(arr)



function tree2list(tree) {
  const list = []
  const queue = [...tree]
  while(queue.length) {
    const node = queue.shift()
    const children = node.children
    if(children) {
        queue.push(...children)
    }
    list.push(node)
  }
  return list
}





```

# mobx 共用一个store

![](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/meonaXkkAQzVlXxj/img/1bfba03b-0442-4104-a929-8cc9062bbba3.png)

```
import { makeAutoObservable } from 'mobx'

let instance: Store

export class Store {
   
}

export default new Proxy(Store, {
    construct(target) {
        if (!instance) {
            instance = new target()
        }
        return instance
    },
})

 const store = useLocalObservable(() => new Store())
```

# url参数改变

```
   const onUrlChange = (key: string, value: string | number) => {
        let url = new URL(location.href)
        if (url.searchParams.has(key)) {
            url.searchParams.delete(key)
        }
        url.searchParams.append(key, value)
          //实现无刷新修改url
        window.history.replaceState({}, '', url)

        let jumpUrl =  url.toString()
     
    }
```

# td td 表格

```
import styles from './index.module.less'
import type AccountingListStore from '../../store'
import type { ReceiveStatisticItemDto } from '@/@types/finance'

/**  应收账款账龄分析  */
const AccountsReceivable = ({ store }: { store: AccountingListStore }) => {
    const { statisticalData = {} } = store || {}
    const { totalMoney = '-', list = [] } = (statisticalData as any) || {}

    const renderTableCells = (
        data: ReceiveStatisticItemDto[],
        accessor: keyof ReceiveStatisticItemDto,
        flag: string,
    ) => {
        return data.map((item: ReceiveStatisticItemDto, index: number) => {
            const value = Number(item[accessor])

            if (isNaN(value)) {
                return <td key={index}>{'-'}</td>
            }

            const formattedValue = accessor === 'money' ? `${flag}${value}` : `${value}${flag}`

            return <td key={index}>{formattedValue}</td>
            // if (Number(item[accessor])) {
            //     if (accessor === 'money') {
            //         return <td key={index}>{`${flag}${Number(item[accessor])}`}</td>
            //     } else {
            //         return <td key={index}>{`${Number(item[accessor])}${flag}`}</td>
            //     }
            // } else {
            //     return <td key={index}>{'-'}</td>
            // }
        })
    }

    return (
        <table className={styles.table}>
            <tr>
                <th>逾期统计</th>
                {/* {list && renderTableCells(list, 'title')} */}
                <th>3个月以内</th>
                <th>3~6个月</th>
                <th>6~9个月</th>
                <th>9~12个月</th>
                <th>12~18个月</th>
                <th>18个月及以上</th>
            </tr>
            <tr>
                <th rowSpan={3}>
                    逾期总金额: ¥ <span className={styles.totalMoney}>{totalMoney}</span>{' '}
                </th>
                {list && renderTableCells(list, 'money', '¥')}
            </tr>
            <tr>{list && renderTableCells(list, 'percent', '%')}</tr>
        </table>
    )
}

export default AccountsReceivable
```

# react-dnd 拖拽

```
import GlobalContent from '@/components/GlobalContent'
import styles from './index.module.less'
import { useCallback, useEffect, useRef, useState } from 'react'
import { useDrag, useDrop } from 'react-dnd'
import { DndProvider } from 'react-dnd'
import { HTML5Backend } from 'react-dnd-html5-backend'
import SVGIcon from '@/components/SVGIcon'
export const ItemTypes = {
    BOX: 'box',
}

const Box = ({ id, text, index, moveBox }: any) => {
    const ref = useRef(null)

    const [, drop] = useDrop({
        accept: ItemTypes.BOX,
        collect(monitor) {
            return {
                handlerId: monitor.getHandlerId(),
            }
        },
        hover(item, monitor) {
            const dragIndex = item.index
            const hoverIndex = index

            if (dragIndex === hoverIndex) {
                return
            }
            // 获取 DOM 元素的位置信息
            const hoverBoundingRect = ref.current.getBoundingClientRect()
            // 计算拖拽元素的垂直中点位置
            const hoverMiddleY = (hoverBoundingRect.bottom - hoverBoundingRect.top) / 2
            // 获取鼠标当前的位置
            const clientOffset = monitor.getClientOffset()
            // 计算鼠标位置相对于容器的垂直偏移量
            const hoverClientY = clientOffset.y - hoverBoundingRect.top

            // 如果拖拽元素在目标元素上方且处于容器的上半部分，则不进行操作
            if (dragIndex < hoverIndex && hoverClientY < hoverMiddleY) {
                return
            }
            // 如果拖拽元素在目标元素下方且处于容器的下半部分，则不进行操作
            if (dragIndex > hoverIndex && hoverClientY > hoverMiddleY) {
                return
            }

            moveBox(dragIndex, hoverIndex)
            item.index = hoverIndex
        },
    })

    const [{ isDragging }, drag, preview] = useDrag({
        item: { id, index },
        type: ItemTypes.BOX,
        collect: monitor => ({
            isDragging: monitor.isDragging(),
        }),
    })

    const opacity = isDragging ? 0 : 1
    const transform = isDragging ? 'translateY(-5px)' : 'none' // 添加平滑移动的动画效果

    /** 整体拖拽   */
    drag(drop(ref))

    return (
        <div
            /*     局部拖拽的视图  ref={drop(preview(ref))} */
            ref={drop(preview(ref))}
            className={styles.item}
            style={{ opacity, transform }} // 应用动画效果
        >
            {/*     局部拖拽 ref={drag} */}
            <span ref={drag} style={{ cursor: 'move', marginRight: '8px', fontSize: '16px' }}>
                <SVGIcon xlinkHref={'#icon-icon_tuodong'} />
            </span>

            {text}
        </div>
    )
}

const DndDemo = () => {
    const [boxes, setBoxes] = useState([
        { id: 1, text: '1' },
        { id: 2, text: '2' },
        { id: 3, text: '3' },
        { id: 4, text: '4' },
    ])

    const moveBox = useCallback(
        (dragIndex, hoverIndex) => {
            const dragBox = boxes[dragIndex]
            setBoxes(prevBoxes => {
                const updatedBoxes = [...prevBoxes]
                updatedBoxes.splice(dragIndex, 1)
                updatedBoxes.splice(hoverIndex, 0, dragBox)
                return updatedBoxes
            })
        },
        [boxes],
    )

    return (
        <DndProvider backend={HTML5Backend}>
            <GlobalContent>
                <div className={styles.page}>
                    {boxes.map((box, index) => (
                        <Box
                            key={box.id}
                            id={box.id}
                            text={box.text}
                            index={index}
                            moveBox={moveBox}
                        />
                    ))}
                </div>
            </GlobalContent>
        </DndProvider>
    )
}

export default DndDemo
```

```
.page {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 1400px;
    height: 2000px;
    margin: 0 auto;
    border: 1px solid #000;
    row-gap: 30px;

    .item {
        width: 600px;
        height: 300px;
        color: #fff;
        font-size: 20px;
        background-color: rebeccapurple;
        transition: transform 0.3s ease-in-out;
        transition-property: transform, opacity;
    }
}
```

# 防抖

```
import { useDebounceFn } from 'ahooks'

 const { run: debouncedValue } = useDebounceFn(store.searchColumns, { wait: 500 })   
  debouncedValue(v)
```

# 省略号...

```
  .contentStyle {
                max-width: 310px;
                -webkit-line-clamp: 2; // 用来限制在一个块元素显示的文本的行数
                display: -webkit-box; // 将对象作为弹性伸缩盒模型显示
                -webkit-box-orient: vertical; //设置或检查伸缩盒对象的子元素的排列方式
                text-overflow: ellipsis; // 在多行文本的情况下，用...隐藏超出范围的文本
                word-break: break-all;
                overflow: hidden;
            }
```

# source-map .eslintrc校验

```
 devtool: 'cheap-module-source-map',                    
.umirc.ts文件


  '@typescript-eslint/no-unused-vars': 2,
 '@typescript-eslint/no-unused-vars': ['error'],
```

cascader 级联

```
import { Cascader, Spin } from 'antd'
// @ts-ignore
import { isEmpty } from 'lodash'
import { observer } from 'mobx-react'
import { useEffect, useState } from 'react'
import type { Options } from './interface'
import { getAuthOptionsByPid } from './api'
import { TerminalEnum } from '../../addJurisd/const'

interface AuthCascaderProps {
    id: string
    value?: any
    onChange?: (value: any[], selectedOptions: any[]) => void
}

const AuthCascader: React.FC<AuthCascaderProps> = ({ value = [], id, onChange }) => {
    const [authOptions, setAuthOptions] = useState<Options[]>([])
    const [loading, setLoading] = useState<boolean>(false)

    const filterData = async (originalData: any) => {
        setLoading(true)
        const currentOptions: Options[] = []
        let newOriginalData = originalData

        if (id) {
            newOriginalData = originalData.filter((o: any) => o.key !== Number(id))
        }

        for (let i = 0; i < newOriginalData.length; i++) {
            const item = newOriginalData[i]
            if (item.terminal !== TerminalEnum.MOBILE) {
                currentOptions.push({
                    label: `${item.title}(${item.key})`,
                    value: item.key,
                    pid: item.pid,
                    terminal: item.terminal,
                    isLeaf: false,
                })
            }
        }
        setLoading(false)
        return currentOptions
    }

    const onInitAuthOptionsList = (pid: number) => {
        return new Promise(resolve => {
            getAuthOptionsByPid(pid).then(async (res: any) => {
                const firstAuthOptions = [{ label: '无', value: 0 }, ...(await filterData(res))]
                setAuthOptions(firstAuthOptions)

                resolve(firstAuthOptions)
            })
        })
    }

    const onLoadData = async (selectedOptions: any[]) => {
        // 异步加载子数据
        const targetOption = selectedOptions[selectedOptions.length - 1]
        if (targetOption.value === 0) return []

        const children = (await getAuthOptionsByPid(targetOption.value)) as any
        const filterChildren = await filterData(children)
        if (!isEmpty(children)) {
            targetOption.children = filterChildren
        } else {
            targetOption.isLeaf = true
        }
        setAuthOptions(() => [...authOptions])

        return Promise.resolve(filterChildren)
    }

    useEffect(() => {
        // 请求第一级数据
        // @ts-ignore
        onInitAuthOptionsList(0).then(async (firstAuthOptions: Options[]) => {
            // 如果pid为0的话，说明没有选中任何权限
            if (value?.[0] === 0) return
            // 请求第二级数据
            const firstIndex = firstAuthOptions.findIndex(
                (item: Options) => item.value === value?.[0],
            )

            if (firstIndex > -1) {
                const secondOptions = await onLoadData([firstAuthOptions[firstIndex]] as any)
                firstAuthOptions[firstIndex].children = secondOptions

                // 请求第三级数据
                const secondIndex = secondOptions.findIndex(
                    (item: Options) => item.value === value?.[1],
                )

                if (secondIndex > -1) {
                    const thirdOptions = await onLoadData([secondOptions[secondIndex]] as any)

                    secondOptions[secondIndex].children = thirdOptions
                }

                setAuthOptions(firstAuthOptions)
            }
        })
    }, [])

    const onChangeData = (changedValue: any[], selectedOptions: any[]) => {
        if (changedValue && selectedOptions) {
            onLoadData(selectedOptions)
        }
        onChange?.(changedValue, selectedOptions)
    }

    return (
        <Spin spinning={loading}>
            <Cascader
                changeOnSelect
                value={!authOptions.length ? undefined : value}
                options={authOptions}
                placeholder="请选择"
                onChange={onChangeData}
                loadData={onLoadData}
                showSearch={true}
            />
        </Spin>
    )
}

export default observer(AuthCascader)
```

# 多选框操作 rowSelections

```
const [selectedPosition, setSelectedPosition] = useState<any>([])

const addSelectRow = (rows: any) => {
 const newList = cloneDeep(selectedPosition)
 setSelectedPosition(newList.concat(rows))
    }
const delSelectRow = (rowkey: string[]) => {
 const newList = cloneDeep(selectedPosition)
 setSelectedPosition(newList.filter((item: any) => !rowkey.includes(item.professionCode)))
    }

const getRowSelections = (store: BatchOfflinePaymentModalStore) => {
    return {
          type: 'checkbox',
          preserveSelectedRowKeys: true,
          selectedRowKeys: selectedPosition.map((item: any) => item?.professionCode),
          // onChange: (_: any, allSelectedRows: any) => {
          //     setSelectedPosition([...allSelectedRows])
          // },
          // checkStrictly: false,
          onSelect: (record: any, selected: boolean) => {
                    if (selected) {
                        addSelectRow(record)
                    } else {
                        delSelectRow([record.professionCode!])
                    }
                },
          onSelectAll: (selected: boolean, selectedRows: any[], changeRows: any[]) => {
             if (selected) {
                 addSelectRow(changeRows)
                } else {
                 delSelectRow(changeRows.map((item: any) => item.professionCode))
                  }
                },
    }
}
```

```

 const { getRowSelections, selected } = useSelections<DataTypes>({
        itemKey: 'id',
    })





import { cloneDeep } from 'lodash'
import type { TableRowSelection } from 'antd/es/table/interface'
import { message } from 'antd'
import { Key, useState } from 'react'


export interface Options<T> {
    /**  默认勾选数据  */
    defaultSelected?: T[] | T
    /**  唯一标识字段  */
    itemKey: keyof T
    /**  选中类型  */
    type?: 'radio' | 'checkbox'
    /**  自定义rowSelection props  */
    rowSelectionProps?: TableRowSelection<T>
    /**  最多可选  */
    max?: number
}
export function useSelections<T>(props: Options<T>) {
    const { defaultSelected, itemKey, type = 'checkbox', rowSelectionProps, max } = props

    const [selected, setSelected] = useState<T[]>(
        (() => {
            if (Array.isArray(defaultSelected)) return defaultSelected
            if (defaultSelected !== undefined) return [defaultSelected]
            return []
        })(),
    )

    /**  增加选中行  */
    const addSelectRow = (rows: T[] | T) => {
        const newList = cloneDeep(selected)

        /**  单选   */
        if (type === 'radio') {
            setSelected([rows as T])
        } else {
            // 达到最大选择数量时不允许添加
            if (max && newList.length >= max) {
                message.error(`最多可选${max}条`)
                return
            }
            setSelected(newList.concat(rows))
        }
    }

    /** 删除选中行  */
    const delSelectRow = (rowkey: number[]) => {
        const newList = cloneDeep(selected)
        setSelected(newList.filter((item: T) => !rowkey.includes(item[itemKey] as number)))
    }

    /**  获取选中行  */
    const getRowSelections = (): TableRowSelection<T> => {
        return {
            type: type,
            preserveSelectedRowKeys: true,
            selectedRowKeys: selected.map((item: T) => item[itemKey]) as Key[],
            onSelect: (record: T, selected: boolean) => {
                if (selected) {
                    addSelectRow(record)
                } else {
                    delSelectRow([record[itemKey] as number])
                }
            },
            onSelectAll: (selected: boolean, _, changeRows: T[]) => {
                if (selected) {
                    addSelectRow(changeRows)
                } else {
                    delSelectRow(changeRows.map((item: T) => item[itemKey] as number))
                }
            },
            ...rowSelectionProps,
        }
    }

    return { getRowSelections, selected }
}
```

# 展开 变成箭头 expanded

```
 /**
     * 展开 变成箭头
     * @param { expanded, onExpand, record }
     * <CaretRightOutlined />  RightOutlined
     */
    const expandIcon = ({ expanded, onExpand, record }: any) => (
        <span className={styles.expanded}>
            {record.children && record.children.length > 0 ? (
                expanded ? (
                    <RightOutlined
                        onClick={e => onExpand(record, e)}
                        className={`${styles.arrow_icon} ${styles.arrow_rotate}`}
                    />
                ) : (
                    <RightOutlined
                        onClick={e => onExpand(record, e)}
                        className={styles.arrow_icon}
                    />
                )
            ) : null}
        </span>
    )


 .expanded {
        display: inline-block;
        min-width: 14px;
        margin-right: 5px;

        .arrow_icon {
            & svg {
                transition: transform 0.3s ease;
            }
        }

        .arrow_icon:hover {
            color: var(--primary-color);
        }

        .arrow_rotate {
            & svg {
                transform: rotate(90deg);
                transition: transform 0.3s ease;
            }
        }
    }
```

# expandedRowKeys

```
    const [expandedRowKeys, setExpandedRowKeys] = useState<any[]>([]) // 展开的行的key

    expandable={{
                    expandIcon,
                    expandedRowKeys,
                }}
                onExpand={(b: boolean, r: any) => {
                    const newExp: any = b
                        ? [...expandedRowKeys, r.id]
                        : expandedRowKeys.filter(i => i !== r.id)
                    setExpandedRowKeys(newExp)
                }}
```

# InputNumber

```
 <InputNumber
                        min={0}
                        max={9999}
                        maxLength={4}
                        defaultValue={sort}
                        onBlur={e => handleSave(key, e.target.value)}
                        formatter={value => {
                            if (!value) return '0'
                            if (!/^[0-9]*$/g.test(value)) {
                                return '0'
                            }

                            return value
                        }}
                        parser={value => {
                            const parsedValue = value?.replace(/\D/g, '')

                            if (!parsedValue || parsedValue.length > 4) {
                                return '0'
                            }

                            return parsedValue
                        }}
                    />

   /**
     * 排序失去焦点的保存事件
     */
    const handleSave = (id: number, value: string | number) => {
        const targetItem =
            store.dataSource?.find((item: { key: number }) => item?.key === Number(id)) || {}
        if (targetItem.sort === Number(value)) {
            return
        }
        let reg = /^[0-9]*$/
        if (!reg.test(value) || !value) {
            message.error('请输入数字')
            return
        }
        if (Number(value) > 9999) {
            message.error('排序不能大于9999')
            store.sortOnBlur({ id, sort: '9999' }, actionRef)
            return
        }

        store.sortOnBlur({ id, sort: value }, actionRef)
    }
```

# UserMenu

```
import type { MenuProps } from 'antd';
import { ConfigProvider, Menu } from 'antd';
import React, { useEffect, useState } from 'react';
import { ReactSVG } from 'react-svg';
import './index.less';

type MenuItem = Required<MenuProps>['items'][number];

function getItem(
  label: React.ReactNode,
  key: React.Key,
  route: string,
  icon?: React.ReactNode,
  children?: MenuItem[],
): MenuItem {
  return {
    key,
    icon,
    children,
    label,
    route,
  } as MenuItem;
}

interface IUserMenuProps {
  menuList: any[];
  masterHistory?: any; // 主应用的history，用来跳转路由
}

/**  个人工作台  */
const UserMenu: React.FC<IUserMenuProps> = ({ menuList, masterHistory }) => {
  // console.log('🍊 menuList:', JSON.parse(JSON.stringify(menuList)));
  /**  当前页面的url 来控制 menu的选中  */
  const currentUrl =
    masterHistory?.location?.pathname === '/'
      ? '/workbench'
      : masterHistory?.location?.pathname;

  // console.log('🍊 currentUrl:', currentUrl);

  /**  menu items  */
  const [MenuItem, setMenuItem] = useState<MenuItem[]>([]);
  /**  选中的key  */
  const [selectKey, SetSelectKey] = useState<string>('/workbench');
  // console.log('🍊 selectKey:', selectKey);

  /**  menu 数据  */
  const items: MenuItem[] = MenuItem;
  useEffect(() => {
    let menuRes = menuList?.map((item) => {
      const {
        title = '',
        children = [],
        route = '',
        icon = '',
        key = '',
      } = item || {};

      if (children && children.length) {
        return getItem(
          title,
          route,
          key,
          '',
          children.map((child: any) => {
            return getItem(
              <span className={'child_content'}>
                <ReactSVG
                  src={child.icon || ''}
                  style={{ width: 14 }}
                  beforeInjection={(svg) => {
                    const svgPath = svg.querySelector('path');
                    svgPath?.removeAttribute('fill');
                    svg.setAttribute(
                      'style',
                      `fill:${
                        selectKey === child.route
                          ? 'currentcolor'
                          : 'rgba(0,0,0,0.45)'
                      }  ;width: 16px;height: 16px;`,
                    );
                  }}
                />
                <span className={'child_title'}>{child.title}</span>
              </span>,
              child.route,
              child.route,
            );
          }),
        );
      }

      return getItem(
        title,
        route,
        route,
        <ReactSVG
          src={icon || ''}
          style={{ height: 40 }}
          beforeInjection={(svg) => {
            const svgPath = svg.querySelector('path');
            svgPath?.removeAttribute('fill');
            svg.setAttribute(
              'style',
              `fill:${
                selectKey === route ? 'currentcolor' : 'rgba(0,0,0,0.45)'
              }  ;width: 16px;height: 16px;`,
            );
          }}
        />,
      );
    });
    setMenuItem(menuRes);
  }, [menuList]);

  /**  openKeys 全部展开  */
  const menuKeys = items.map((item) => item?.key);

  /**
   *  点击菜单
   */
  const handleClickMenuItem = ({ key }: { key: string }) => {
    console.log('🍊 key:', key);
    SetSelectKey(key);
    if (key?.includes('https') || key?.includes('http')) {
      window.location.href = key;
    } else {
      masterHistory.push(key);
    }
  };

  return (
    <ConfigProvider prefixCls="ant">
      <Menu
        defaultSelectedKeys={[currentUrl || '/workbench']}
        openKeys={menuKeys as any}
        mode="inline"
        items={items}
        className="user_menu"
        onClick={handleClickMenuItem}
      />
    </ConfigProvider>
  );
};

export default UserMenu;
```

# devtool source-map

```
devtool: process.env.NODE_ENV === 'development' ? 'eval-cheap-module-source-map' : 'source-map',
```

# 设置时间选择的范围 disabledTime

```
// 

 //设置时间选择的范围
    const disabledTime = (date: any) => {
        const hour = dayjs().hour() // 获取当前的小时
        const min = dayjs().minute() // 获取当前的分钟
        const second = dayjs().second() // 获取当前秒
        if (date?.format('YYYY-MM-DD').valueOf() === dayjs().format('YYYY-MM-DD').valueOf()) {
            if (date?.format('HH').valueOf() === dayjs().format('HH').valueOf()) {
                if (date?.format('mm').valueOf() === dayjs().format('mm').valueOf()) {
                    return {
                        disabledHours: () => range(0, 24).splice(0, hour),
                        disabledMinutes: () => range(0, 60).splice(0, min),
                        disabledSeconds: () => range(0, 60).splice(0, second),
                    }
                } else {
                    return {
                        disabledHours: () => range(0, 24).splice(0, hour),
                        disabledMinutes: () => range(0, 60).splice(0, min),
                    }
                }
            } else {
                return {
                    disabledHours: () => range(0, 24).splice(0, hour),
                }
            }
        }
    }

               <DatePicker
                  showTime={{ format: 'HH:mm:ss' }}
                  format="YYYY-MM-DD HH:mm:ss"
                  placeholder="请选择付款时间"
                  disabledDate={cur => cur && cur < dayjs().startOf('day')}
                  disabledTime={disabledTime}
                  // bordered={false}
               />
```

```
    const disabledTimeBefore = (date: any) => {
        const now = dayjs() // 当前时间

        if (date?.isSame(now, 'day')) {
            const hour = now.hour() // 当前的小时
            const min = now.minute() // 当前的分钟
            const second = now.second() // 当前秒

            return {
                disabledHours: () => range(hour + 1, 24),
                disabledMinutes: (selectedHour: number) => {
                    if (selectedHour === hour) {
                        return range(min + 1, 60)
                    }
                    return []
                },
                disabledSeconds: (selectedHour: number, selectedMinute: number) => {
                    if (selectedHour === hour && selectedMinute === min) {
                        return range(second + 1, 60)
                    }
                    return []
                },
            }
        }
    }


  <DatePicker
            showTime={{ format: 'HH:mm:ss' }}
            format="YYYY-MM-DD HH:mm:ss"
            placeholder="请选择支付时间"
            disabledDate={cur => cur && cur.isAfter(dayjs(), 'day')}
            disabledTime={disabledTimeBefore}
   />
```

```
 <DatePicker
                        getPopupContainer={target => target.parentNode as any}
                        showTime={{
                            format: 'HH:mm',
                        }}
                        format="YYYY-MM-DD HH:mm"
                        placeholder="请选择时间"
                        style={{ width: '100%' }}
                        disabledTime={disabledTime as any}
                        disabledDate={(cur: Dayjs) => {
                            const { activityStart } = form.getFieldsValue()
                            // 如果没有设置开始时间，则可设置今天及以后的时间
                            if (!activityStart) {
                                // @ts-ignore
                                return cur < dayjs().startOf('day')
                            }
                            // 如果设置了开始时间，则可设置【开始时间】及以后的时间
                            // @ts-ignore
                            return cur < dayjs(activityStart).startOf('day')
                        }}
                        disabled={judgeEdit(form.getFieldValue('endTime'))}
                    />

   /**  限制修改字段  */
    const judgeEdit = (time: any) => {
        dayjs.extend(isSameOrBefore)

        let today = dayjs().startOf('day')
        let flag = dayjs(time).isSameOrBefore(today, 'day') || false
        if (cannotEdit && flag) {
            return true
        } else {
            return false
        }
    }



```

# rgba 转 十六进制

```
/**  #f00 ===> rgba  */
export function hexToRGBA(hex: string) {
  const r = parseInt(hex.substring(1, 3), 16);
  const g = parseInt(hex.substring(3, 5), 16);
  const b = parseInt(hex.substring(5, 7), 16);
  const a = parseInt(hex.substring(7, 9), 16) / 255; // 将十六进制透明度转换为 0-1 范围内的值
  return { r: r, g: g, b: b, a: a };
}

/**  rgba ===>  #f00  */
export function rgbaToHex({
  r,
  g,
  b,
  a,
}: {
  r: number;
  g: number;
  b: number;
  a: number;
}) {
  let newr = Math.round(r);
  let newg = Math.round(g);
  let newb = Math.round(b);
  let newa: string | number = Math.round(a * 255); // 将透明度从 0-1 转换为 0-255 范围内的值
  newa = (newa | (1 << 8)).toString(16).slice(1); // 转换为十六进制并确保始终是两位

  return (
    '#' +
    ((1 << 24) + (newr << 16) + (newg << 8) + newb).toString(16).slice(1) +
    newa
  );
}
```

# 解决富文本图片不居中问题

```
        /**  解决富文本图片不居中问题  */
        let parser = new DOMParser()
        let doc = parser.parseFromString(detail as string, 'text/html')

        // 找出所有包含 img 标签的父级 p 元素
        let imgParents = doc.querySelectorAll('p > img')

        // 遍历每个 img 的父级 p 元素
        imgParents.forEach(parent => {
            // @ts-ignore 获取父级 p 元素的 text-align 属性值
            let textAlign = parent?.parentNode?.style.textAlign

            const alignmentClassMap: Record<string, string> = {
                left: 'img_left',
                start: 'img_start',
                center: 'img_center',
                right: 'img_right',
                justify: 'img_justify',
                // 如果有其他对应关系，可以继续添加
            }
            // @ts-ignore
            parent?.parentNode?.classList.add(alignmentClassMap[textAlign])
        })
        let modifiedHtmlStr = doc.documentElement.innerHTML
```

# Cascader

```
interface RegionSelectorProps {
    holder?: string
    value?: any
    onChange?: (e: any) => void
}
const RegionSelector: React.FC<RegionSelectorProps> = ({ holder, value = [], onChange }) => {
    const [options, setOptions] = useState<Option[]>([])
    const [isInit, setIsInit] = useState(true)

    const getAreaData = async (parentCode: string | number) => {
        const data = (await Http(
            api.getAreaData,
            'get',
            { parentCode: parentCode },
            { repeatFilter: false },
        )) as unknown as []
        let list: Option[] = []
        data.forEach((item: any) => {
            list.push({
                label: item.name,
                value: item.code,
                isLeaf: ![0, 1, 2].includes(item.level), // 0 国家层级 1 省份层级 2 市区层级 3 地区层级
            })
        })
        return list
    }

    const handleAreaList = async (value: string[]) => {
        const list = await getAreaData('-1') // 默认请求国家层级数据
        // 如果value的长度是3(国、省、市)，只需要请求两次 分别获取province, city层级数据
        // 如果value的长度是2(国、省)，只需要请求一次 获取province层级数据
        // 如果value的长度是1(国)，不需要请求(初始化已经请求过国家层级数据了)
        const [country, province, city] = value.slice()
        let targetProvince, targetCountry, targetCity
        let provinces, cities
        if (value.length >= 2) {
            provinces = await getAreaData(country)
            // 将省级放到对应国级children里面
            targetCountry = list.find(_country => Number(_country.value) === Number(country)) ?? {}
            targetCountry.children = provinces
        }

        if (value.length >= 3) {
            cities = await getAreaData(province)
            // 将城市放到对应的省级children里面
            targetProvince =
                provinces.find(_province => Number(_province.value) === Number(province)) ?? {}
            targetProvince.children = cities
        }
        // 将区级放到市级下面
        if (value.length >= 4) {
            const areas = await getAreaData(city)
            targetCity = cities.find(_city => Number(_city.value) === Number(city)) ?? {}
            targetCity.children = areas
        }
        setOptions(list)
    }
    const getAreaOptions = async (selectedOptions: Option[]) => {
        const targetOption = selectedOptions[selectedOptions.length - 1]
        targetOption.loading = true
        const currentList = await getAreaData(targetOption.value)
        targetOption.loading = false
        targetOption.children = currentList
        setOptions([...options])
    }

    useEffect(() => {
        if (!value?.length) {
            handleAreaList(value)
        }

        // 回显数据
        if (value?.[0] !== undefined && isInit) {
            // 避免value空数组重复渲染
            setIsInit(false)
            handleAreaList(value)
        }
    }, [value?.[0]])

    return (
        <Cascader
            value={value}
            options={options}
            loadData={getAreaOptions}
            placeholder={holder}
            changeOnSelect
            onChange={onChange}
        />
    )
}
```

# 地图

```
import React, { useEffect, useState } from 'react'
import { Modal } from 'antd'
import wrapper from '@/utils/wrapper'
import styles from './index.module.less'
import AMapLoader from '@amap/amap-jsapi-loader'
import { Input, message } from 'antd'
const { Search } = Input

interface AMapModalProps {
    visible: boolean
    closeDialog: () => void
    value?: string
    submit?: (value?: string) => void
}
/**  地图实例  */
let map: any = null
/**  标记  */
let marker: any = null
/**  比例尺  */
let scale: any = null
/**  工具条  */
let toolBar: any = null
/**  搜索  */
let placeSearch: any = null
let auto: any = null
/**  点击事件  */
let geocoder: any = null
//输入提示
let autoOptions = {
    input: 'tipinput',
}

const AMapModal: React.FC<AMapModalProps> = props => {
    const { visible, closeDialog, value, submit } = props
    const [searchValue, setSearchValue] = useState('')

    const onSearch = (v: string) => {
        setSearchValue(v) // 更新搜索框输入的值
        placeSearch?.search(searchValue)
    }
    /**  选择事件  */
    function select(e: any) {
        placeSearch.setCity(e?.poi?.adcode)
        placeSearch.search(e?.poi?.name) //关键字查询查询
        marker.setPosition(e?.poi?.location)
    }
    /**  点击事件  */
    function showInfoClick(e: any) {
        marker.setPosition(e?.lnglat)
        // 逆地理编码获取地点信息
        geocoder?.getAddress(e?.lnglat, function (status: any, result: any) {
            if (status === 'complete' && result?.info === 'OK') {
                if (result.regeocode && result.regeocode.formattedAddress) {
                    let address = result?.regeocode?.formattedAddress
                    setSearchValue(address)
                }
            } else {
                message.error('逆地理编码失败')
            }
        })
    }

    useEffect(() => {
        if (value) {
            onSearch(value)
        }
    }, [value])

    useEffect(() => {
        // @ts-ignore
        window._AMapSecurityConfig = {
            securityJsCode: '75204b4ecec46a97e9906a83b0cc8b5d',
        }
        AMapLoader.load({
            key: '1ae45beffb6052b82267651855e0bcc7', // 申请好的Web端开发者Key，首次调用 load 时必填
            version: '2.0', // 指定要加载的 JSAPI 的版本，缺省时默认为 1.4.15
            plugins: [
                'AMap.Scale', //比例尺
                'AMap.ToolBar', // 工具条
                'marker', //标记
                'AMap.Geolocation', // 大致定位
                'AMap.PlaceSearch', //搜索
                'AMap.AutoComplete', //搜索
                'AMap.Geocoder', // 逆地理编码（坐标 -> 地址）
            ], //需要使用的的插件列表，
        })
            .then(AMap => {
                map = new AMap.Map('mapContainer', {
                    zoom: 15, //初始化地图层级
                    resizeEnable: true,
                })
                // 标记
                marker = new AMap.Marker({})
                /**  比例尺  */
                scale = new AMap.Scale({
                    visible: true,
                })
                /**  工具条  */
                toolBar = new AMap.ToolBar({
                    visible: true,
                    position: {
                        top: '110px',
                        right: '40px',
                    },
                })
                auto = new AMap.AutoComplete(autoOptions)
                placeSearch = new AMap.PlaceSearch({
                    map: map,
                })
                placeSearch?.search(value)
                AMap.plugin(['AMap.PlaceSearch', 'AMap.AutoComplete'], function () {
                    auto.on('select', select) //注册监听，当选中某条记录时会触发
                })
                geocoder = new AMap.Geocoder({
                    city: '010', //城市设为北京，默认：“全国”
                    radius: 1000, //范围，默认：500
                })

                map.add(marker)
                map.addControl(scale)
                map.addControl(toolBar)
                map.on('click', showInfoClick)
            })
            .catch(e => {
                console.log(e)
            })
        return () => {
            map?.destroy()
        }
    }, [])

    return (
        <Modal
            open={visible}
            centered
            width={1200}
            title={'添加活动地点'}
            onCancel={closeDialog}
            onOk={() => {
                submit?.(searchValue)
                closeDialog()
            }}
        >
            <div className={styles.page_modal}>
                <div id="myPageTop" className={styles.page_modal_top}>
                    <Search
                        id="tipinput"
                        placeholder="输入考勤地点"
                        enterButton="搜索"
                        size="large"
                        onSearch={onSearch}
                        value={searchValue}
                        onChange={(e: any) => {
                            setSearchValue(e.target.value)
                        }}
                    />
                </div>
                <div id="mapContainer" style={{ width: '100%', height: '400px' }} />
            </div>
        </Modal>
    )
}

export default wrapper(AMapModal)
```

```
import React, { useEffect, useRef, useState } from 'react'
import { Modal, Select } from 'antd'
import wrapper from '@/utils/wrapper'
import styles from './index.module.less'
import _ from 'lodash'

interface AMapModalProps {
    visible: boolean
    closeDialog: () => void
    value?: any
    submit?: (value?: object) => void
}

const AMapModal: React.FC<AMapModalProps> = props => {
    const { visible, closeDialog, value, submit } = props
    const mapData = useRef<null | object>(null)
    const mapRef = useRef<any>(null)
    const markerLayer = useRef<any>(null)
    const [suggestions, setSuggestions] = useState([])

    /**  搜索  */
    const handleSearchByKeyword = _.throttle((keyword: string) => {
        // 使用者在搜索框中输入文字时触发
        if (keyword) {
            // @ts-ignore 新建一个关键字输入提示类
            const suggest = new window.TMap.service.Suggestion({
                pageSize: 10,
            })
            suggest
                .getSuggestions({ keyword: keyword, location: mapRef.current?.getCenter() })
                .then((result: any) => {
                    const list = result?.data.map((item: any) => ({
                        label: item.title,
                        value: `${item.location.lng},${item.location.lat}`,
                    }))
                    setSuggestions(list)
                })
                .catch((error: any) => {
                    console.error(error)
                })
        }
    }, 500)

    /**  获取地址信息  // 将给定的坐标位置转换为地址 */
    const getLocationInfo = async (values: any) => {
        // @ts-ignore
        const location = new window.TMap.LatLng(values.lat, values.lng)
        // @ts-ignore
        const geocoder = new window.TMap.service.Geocoder()
        const { result } = await geocoder.getAddress({ location }) // 将给定的坐标位置转换为地址
        console.log('🍊 result:', result)
        const regex = /^156/

        const params = {
            addressInfo: result.address,
            city: result.ad_info.city,
            cityCode: result.ad_info.city_code.replace(regex, ''),
            companyAddress: result.address,
            latitude: values.lat,
            longitude: values.lng,
            province: result.ad_info.province,
            provinceCode: result.ad_info.adcode.slice(0, 2) + '0000',
            region: result.ad_info.district,
            regionCode: result.ad_info.adcode,
            // label: values?.title || result.address,
            label: result?.formatted_addresses?.standard_address || values?.title,

            value: values.lng + ',' + values.lat,
        }

        mapData.current = params
    }

    /**   将选中的地址放在地图中心  添加地图标记点markerLayer  */
    const handleGetSuggestions = (item: any) => {
        if (!item) return
        const lngLat = item?.value.split(',')
        // @ts-ignore
        const centerLngLat = new window.TMap.LatLng(lngLat[1], lngLat[0])
        mapRef.current?.setCenter(centerLngLat)
        markerLayer.current?.updateGeometries([{ id: '1', position: centerLngLat }])
        const [lng, lat] = item?.value.split(',') || []
        getLocationInfo({ lng, lat, title: item?.label })
    }
    /**  地图点击事件  */
    const handleMapClick = (evt: any) => {
        const { latLng } = evt
        // @ts-ignore
        const centerLngLat = new window.TMap.LatLng(latLng?.lat, latLng?.lng)
        mapRef.current?.setCenter(centerLngLat)
        markerLayer.current?.updateGeometries([{ id: '1', position: centerLngLat }])
        getLocationInfo({ lng: latLng?.lng, lat: latLng?.lat })
    }

    const initMap = () => {
        // @ts-ignore 初始化地图
        const map = new window.TMap.Map('container', {
            zoom: 15, // 设置默认地图比例
            // @ts-ignore
            mapZoomType: window.TMap.constants.MAP_ZOOM_TYPE.CENTER, // 地图缩放焦点控制
        })
        mapRef.current = map
        // @ts-ignore
        markerLayer.current = new window.TMap.MultiMarker({
            map: map, //指定地图容器
        })

        // 绑定地图点击事件
        mapRef.current.on('click', handleMapClick)
    }

    useEffect(() => {
        setTimeout(() => {
            initMap()
        }, 50)
    }, [])

    useEffect(() => {
        setTimeout(() => {
            if (value) {
                handleGetSuggestions(value)
            }
        }, 100)
    }, [value])

    return (
        <Modal
            open={visible}
            centered
            width={1200}
            title={'添加活动地点'}
            onCancel={closeDialog}
            onOk={() => {
                console.log('🍊 mapData:', mapData)
                submit?.(mapData)
                closeDialog()
            }}
        >
            <div className={styles.page_modal}>
                <div id="myPageTop" className={styles.page_modal_top}>
                    <Select
                        style={{ width: '100%' }}
                        showSearch
                        placeholder="请输入地址"
                        defaultActiveFirstOption={false}
                        showArrow={false}
                        filterOption={false}
                        onSearch={handleSearchByKeyword}
                        onChange={handleGetSuggestions}
                        notFoundContent={null}
                        options={suggestions}
                        labelInValue
                    />
                </div>
                <div id="container" style={{ width: '100%', height: '400px' }} />
            </div>
        </Modal>
    )
}

export default wrapper(AMapModal)
```

# 添加url params

```

/**  添加url  */
export const addFormParams = (key: string, e: number) => {
    let currentUrl = new URL(window.location.href)

    if (currentUrl.searchParams.has(key)) {
        currentUrl.searchParams.delete(key)
    }

    currentUrl.searchParams.append(key, e.toString())
    window.history.replaceState({}, '', currentUrl)
}
```

# 录音 转文字

```
  /**  开始录音  */
    const startRecording = () => {
        recorder.current = window.Recorder({
            onProcess: function (
                buffers: any,
                _powerLevel: any,
                _bufferDuration: any,
                bufferSampleRate: any,
                newBufferIdx: any,
            ) {
                // 实时推入asr处理。asr.input随时都可以调用，就算asr并未start，会缓冲到asr.start完成然后将已input的数据进行识别
                /** 不说话的时候会识别出一个字，所以加个优化 */
                if (asrRef.current && (_powerLevel > 3 || asrTextRef?.current)) {
                    asrRef.current.input(buffers, bufferSampleRate, newBufferIdx)
                } else {
                    asrRef.current.input([new Int16Array(9)], bufferSampleRate, 0)
                }
            },
        })
        asrRef.current = window.Recorder.ASR_Aliyun_Short({
            tokenApi: '/ai/front/voice/get_key',
            apiRequest: (url: any, _args: any, success: any) => {
                http(url, 'GET', {}).then((data: any) => {
                    success({ appkey: data.appKey, token: data.token })
                })
            },
            asrProcess: (text: string, nextDuration: any, abortMsg: string) => {
                if (abortMsg) {
                    //语音识别中途出错，单个文件识别无需任何处理，会自动回调结果
                    return false
                }
                asrTextRef.current = text
                console.log('[asrProcess回调]当前识别结果：' + text, nextDuration)
                if (value) {
                    if (max && value?.length >= max) {
                        Toast.show(`最多可填${max}个字`)
                        asrRef.current?.stop()
                        recorder.current?.close()
                        return
                    }
                    setValue(value + text)
                } else {
                    if (max && text?.length >= max) {
                        setValue(text.slice(0, max))
                        Toast.show(`最多可填${max}个字`)
                        asrRef.current?.stop()
                        recorder.current?.close()
                        return
                    }
                    setValue(text)
                }
                const textArea_id: any = document.getElementById('textArea_id')
                textArea_id.scrollTop = textArea_id.scrollHeight

                return true
            },
            log: (msg: any) => {
                console.log(msg)
            },
            //高级选项
            fileSpeed: 1,
        })

        recorder.current.open(
            () => {
                if (store.isLongPress) {
                    asrRef.current.start(
                        function () {
                            //开始录音
                            recorder.current.start()
                        },
                        function (errMsg: any) {
                            console.log('🍊 errMsg:', errMsg)
                        },
                    )
                } else {
                    asrRef.current.stop()
                    recorder.current?.close()
                }
            },
            (msg: string, isUserNotAllowed: any) => {
                store.upDatePress(false)
                Toast.show(isUserNotAllowed ? '用户拒绝了授权' : msg)
            },
        )
    }

    /**  按下  */
    const handleMouseDown = () => {
        store.upDatePress(true)
        timeoutRef.current = setTimeout(() => {
            // Toast.show('开始录音')
            navigator.vibrate =
                navigator?.vibrate ||
                navigator?.webkitVibrate ||
                navigator?.mozVibrate ||
                navigator?.msVibrate
            //支持设备震动
            if (navigator.vibrate) {
                navigator.vibrate(200)
            }
            startRecording()
        }, 500)
    }

    /**  松开  */
    const handleMouseUp = () => {
        clearTimeout(timeoutRef.current)
        // Toast.show('结束录音')
        if (store.isLongPress) {
            store.upDatePress(false)

            recorder.current?.stop(() => {
                /** 暂停ars */
                asrRef.current.stop((text: string) => {
                    console.log('text:', text)
                })
                asrRef.current.stop()
                recorder.current?.close()
            })
        } else {
            Toast.show('请先说点什么')
        }
    }
```

# ScrollListView 我还是有底线的

```
@import url('~@/styles/mixin.less');
:global {
    .adm-infinite-scroll {
        margin-top: 0 !important;
        padding: 0;
    }
}
.loadMore {
    width: 702px;
    height: 88px;
    color: #999;
    font-size: 28px;
    line-height: 88px;
    text-align: center;
    span {
        margin-right: 8px;
    }
}
.endText {
    gap: 24px;
    width: 702px;
    height: 88px;
    margin: 0 auto;
    color: #999;
    font-size: 28px;
    .flex(center,center);
    > div {
        width: 80px;
        height: 2px;
        background: #ddd;
    }
}
```

```
/* eslint-disable react-hooks/exhaustive-deps */
import { useCallback, useEffect, useState, useRef } from 'react'
import { InfiniteScroll } from 'antd-mobile'
import type { Props } from './interface'
import styles from './index.module.less'
import IconFont from '@/components/Common/IconFont'
import { useDeepCompareEffect } from 'ahooks'
let page = 0
export const transformData = (list: any, flag: boolean) => {
    if (flag) {
        return list.map((item: any) => {
            return {
                ...item,
                selected: false,
            }
        })
    }
    return list
}

export default function ScrollListView<T extends object, P>(props: Props<T, P>) {
    const { render, requestApi, params, getInfo, onDataChange } = props
    const [dataSource, setDataSource] = useState<T[]>([])
    const [total, setTotal] = useState<number>(0)
    const [loading, setLoading] = useState(true)
    const prevTapRef = useRef<any>(null) // 用于存储上一次的tap信息

    useDeepCompareEffect(() => {
        onDataChange?.(dataSource)
    }, [dataSource])

    const request = useCallback(
        async (isReload?: boolean) => {
            page = page + 1
            const requestParams = {
                per_page: 10,
                page,
                ...(params || ({} as P)),
            }
            const { data } = await requestApi(requestParams)
            // @ts-ignore 比较tap的变化，只在tap更新时调用getInfo
            if (JSON.stringify(data?.tap) !== JSON.stringify(prevTapRef.current)) {
                // @ts-ignore
                getInfo?.(state => {
                    // @ts-ignore
                    return isReload ? data?.tap : { ...state, ...data?.tap }
                })
                // @ts-ignore
                prevTapRef.current = data?.tap // 更新prevTapRef
            }

            setLoading(false)
            setDataSource(state => {
                return isReload ? data.list : [...state, ...data.list]
            })

            page === 1 && setTotal(data.total)
        },
        [params],
    )
    const reload = () => {
        page = 0
        request(true)
    }

    useEffect(() => {
        request(true)
        return () => {
            page = 0
        }
    }, [request])

    const sliceArr = (data: T[]): { leftList: T[]; rightList: T[] } => {
        const leftList: T[] = []
        const rightList: T[] = []
        let isLeft = true
        data.forEach((item, index) => {
            if (isLeft && index !== data.length - 1) {
                leftList.push(item)
                isLeft = !isLeft
            } else {
                rightList.push(item)
                isLeft = !isLeft
            }
        })
        return { leftList, rightList }
    }

    return (
        <>
            {render(dataSource, reload, sliceArr(dataSource), loading)}
            <InfiniteScroll loadMore={() => request()} hasMore={dataSource.length < total}>
                {hasMore => {
                    if (hasMore) {
                        return (
                            <div className={styles.loadMore}>
                                <span>
                                    {' '}
                                    <IconFont type="icon-icon_jiazai" />
                                </span>
                                正在努力加载中...
                            </div>
                        )
                    }
                    if (!dataSource.length) return null
                    return (
                        <div className={styles.endText}>
                            <div />
                            <span>我还是有底线的</span>
                            <div />
                        </div>
                    )
                }}
            </InfiniteScroll>
        </>
    )
}
```

```
import type { ReactElement } from 'react'
import type { HttpResponsePending } from '@/server/interface'
import type { PaginationType } from '@/types'

/**响应类型 */
export interface RequestResult<T> {
    list: T[]
    total: number
}

/**
 * @T 返回list数据类型
 * @P 除了分页以外其他参数
 */
export interface Props<T, P> {
    /** 参数为data数据，render需要返回JSX元素 */
    render: (
        data: T[],
        reload: () => void,
        sliceArr: { leftList: T[]; rightList: T[] },
        /** 加载中 */
        loading?: boolean,
    ) => ReactElement
    /** 除分页外 请求携带的其他参数 */
    params?: P
    /** 请求接口 约束为Promise */
    requestApi: (v: P & PaginationType) => HttpResponsePending<{ list: T[]; total: number }>
    /**  获取Info  */
    getInfo?: (v: any) => void
}
```

```
                  <ScrollListView<ProductType, ProductListReq>
                        render={renderList}
                        requestApi={getProductList}
                        params={params}
                    />
```